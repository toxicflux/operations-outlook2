{
  "gitSyncId": "66cf0d36fe2d9c733c8c472f_817ca66a-19d0-4e28-983f-5a2417b00309",
  "id": "Monthly Rig Performance_NPT_monthly_cutoff",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "with cte1 as( \nselect npd_wellbore, idwell, activitystart, activityend, \ncase when classification = 'P' then duration end as days_p, \ncase when classification = 'WOW' then duration end as days_wow, \ncase when classification = 'NPT' then duration end as days_npt, \nduration, rigname as rig_name,cutoffmonth\nfrom  \ndwh.factwvactivity \nwhere \nactivitystart>=TO_DATE('{{datetime.getStartDate()}}', 'YYYY-MM-DD') AND activityend<= TO_DATE('{{datetime.getEndDate()}}', 'YYYY-MM-DD') \nORDER BY activitystart ) , \ncte2 as ( \nselect rig_name,npd_wellbore,  cutoffmonth,\n--min(activitystart) as mindate, \n--max(activityend) as maxdate, \nsum(days_wow*24) as wowhours, \nsum(days_npt*24) as npthours, \nsum(duration*24) as totalhours, \nSUM(COALESCE(days_wow*24,0)) + SUM(COALESCE(days_npt*24,0)) as npttotalhours \nfrom cte1 group by npd_wellbore, rig_name, cutoffmonth ) \n\nselect CONCAT(SUBSTRING(cutoffmonth::text, 1,4), '-', SUBSTRING(cutoffmonth::text, 5, 6)) as cutoffmonth, sum(wowhours/24) as wow_days, sum(npthours/24) as npt_days, sum(totalhours/24) as total_days, sum(npttotalhours/24) as npttotal_days, sum(totalhours/24) - sum(npttotalhours/24) as productive_days, count(cutoffmonth) number_of_rigs\nfrom cte2 c \nleft join dwh.dimwellbore w on c.npd_wellbore=w.npd_wellbore \n\nWHERE c.totalhours > 0 AND ({{typeof appsmith.store.wellbores === 'undefined'}} is TRUE OR c.npd_wellbore = ANY ({{appsmith.store.wellbores}})) AND w.drillingoperator = 'VÃ¥r Energi ASA'\nGROUP BY cutoffmonth ",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "PostgresDB",
      "isAutoGenerated": false,
      "name": "PostgresDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": true,
    "name": "NPT_monthly_cutoff",
    "pageId": "Monthly Rig Performance",
    "userSetOnLoad": true
  }
}